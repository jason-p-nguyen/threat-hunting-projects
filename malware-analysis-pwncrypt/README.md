# üßæ Malware Analysis Report: PwnCrypt Ransomware Simulation

---

## üìÑ 1. Executive Summary

**Sample Name:** `pwncrypt.ps1`  
**Type:** Simulated Ransomware (Educational)  
**Execution Date:** 2025-08-04  
**Analyst:** Jason Nguyen  
**Purpose:** This is a controlled simulation of ransomware behavior using the `PwnCrypt.ps1` script created by Josh Madakor. The analysis was conducted in an isolated Windows 10 VM onboarded to Microsoft Defender for Endpoint (MDE). The goal was to understand how ransomware operates and learn how to analyze file, log, and network artifacts.

![screenshot](screenshots/1-pwncrypt.png)

---
## üìö 2. Table of Contents

1. [üìÑ Executive Summary](#-1-executive-summary)
2. [üìö Table of Contents](#-2-malware-sample-details)
3. [üß¨ Malware Sample Details](#-3-malware-sample-details)
4. [üîç Static Analysis Summary](#-4-static-analysis-summary)
5. [üöÄ Dynamic Analysis Summary](#-5-dynamic-analysis-summary)
6. [üì° MDE-Based Artifact Collection (KQL + Logs)](#-6-mde-based-artifact-collection-kql--logs)
7. [üß† Indicators of Compromise (IOCs)](#-7-indicators-of-compromise-iocs)
8. [üõ°Ô∏è Mitigation & Detection Recommendations](https://github.com/jason-p-nguyen/threat-hunting-projects/blob/main/malware-analysis-pwncrypt/README.md#%EF%B8%8F-8-mitigation--detection-recommendations)
9. [üîó Kill Chain ‚Üî MITRE ATT&CK Mapping](#-9-kill-chain--mitre-attck-mapping)
10. [üìé Appendix](#-10-appendix)
11. [üßæ Postmortem](#11-postmortem)

---

## üß¨ 3. Malware Sample Details

| Field         | Value                                                                 |
|---------------|-----------------------------------------------------------------------|
| Filename      | `pwncrypt.ps1`                                                        |
| SHA-256       | `739D9923E2DDF467CE9F997C82D36BFB72ACCC90ACC40573EAA5E1ABB2097CD8`    |
| File Path     | `C:\ProgramData\pwncrypt.ps1`                                         |
| File Type     | PowerShell script (`.ps1`)                                            |
| Source        | [GitHub - Josh Madakor Public Repo](https://github.com/joshmadakor1/lognpacific-public/blob/main/cyber-range/entropy-gorilla/pwncrypt.ps1) |
| File Size     | 6.29 KB                                                      |
| First Seen    | 31 July 2025 (VirusTotal)               |

> üö® **Disclaimer:** This is a safe, educational ransomware simulation. It performs fake file encryption for training only and does not contain any real malicious payloads.

---

## üîç 4. Static Analysis Summary

- **Hash Check:**
  - SHA256: `739D9923E2DDF467CE9F997C82D36BFB72ACCC90ACC40573EAA5E1ABB2097CD8`
![screenshot](screenshots/2-hash.png)

- **Strings:** *(Attempted `strings` extraction, encountered error)*

- **VirusTotal Result:** No detection (0/70), file considered benign.
![screenshot](screenshots/3-virustotal1.png)
![screenshot](screenshots/4-virustotal2.png)
![screenshot](screenshots/5-virustotal3.png)

- **PEStudio:**
  - PEStudio ran successfully (screenshots captured).
  - *No anomalies noted due to being a PowerShell script*.
![screenshot](screenshots/6-pestudio1.png)
![screenshot](screenshots/7-pestudio2.png)
![screenshot](screenshots/8-pestudio3.png)
![screenshot](screenshots/9-pestudio4.png)
![screenshot](screenshots/10-pestudio5.png)

---

## üöÄ 5. Dynamic Analysis Summary

### üñ•Ô∏è Execution Environment
- **Host:** Windows 10 VM (`j-win10-cve`)
- **Monitoring Tools:** MDE, Event Viewer, PowerShell logs, file system access

### üìÇ File System Activity
- Encrypted dummy files detected 
![screenshot](screenshots/11-cryptedfiles.png)

- Ransom note `README.txt` dropped (screenshot taken)
![screenshot](screenshots/12-ransomnote.png)

- Script stored at `C:\ProgramData\pwncrypt.ps1` (screenshot taken)
![screenshot](screenshots/13-filelocation.png)
![screenshot](screenshots/14-pwncryptcontents.png)

### üßæ Windows Logs (Event Viewer)
- **Security Logs (4688):**
  - No clear matches outside standard boot processes
![screenshot](screenshots/15-securitylogs.png)

- **PowerShell Operational Logs:**
  - Execution of `pwncrypt.ps1` found at 2025-08-04 06:29:36
![screenshot](screenshots/16-pwncryptstart.png)

  - 8 total logs captured (screenshots saved)
![screenshot](screenshots/17-logtotal.png)

  - Final event at 2025-08-04 06:29:37
 ![screenshot](screenshots/18-pwncryptstop.png)

- **ScriptBlock Logging:** Not available (PowerShell Operational Logs were disabled)

---

## üì° 6. MDE-Based Artifact Collection (KQL + Logs)

### üîç File Events (`DeviceFileEvents`)
```kql
DeviceFileEvents
| where DeviceName == "j-win10-cve"
| where InitiatingProcessAccountName == "jnguyen.admin"
| where Timestamp between (datetime(2025-08-04T06:29:35.8265017Z) .. datetime(2025-08-04T06:29:37.3271798Z))
| project Timestamp, DeviceName, Account = InitiatingProcessAccountName, ActionType, FileName, FolderPath, InitiatingProcessCommandLine, SHA256
| order by Timestamp asc
````

* **Status:** Query executed, logs exported, and screenshot captured.
* [See DeviceFileEvents CSV here](logs/devicefileevents.csv)

![screenshot](screenshots/19-devicefileevents.png)

### ‚öôÔ∏è Process Events (`DeviceProcessEvents`)

```kql
DeviceProcessEvents
| where DeviceName == "j-win10-cve"
| where AccountName == "jnguyen.admin"
| where Timestamp between (datetime(2025-08-04T06:29:35.8265017Z) .. datetime(2025-08-04T06:29:37.3271798Z))
| project Timestamp, DeviceName, AccountName, ActionType, FileName, FolderPath, ProcessCommandLine, SHA256, InitiatingProcessCommandLine
| order by Timestamp asc
```

* **Status:** Logs and screenshots captured, CSV export completed.
* [See DeviceProcessEvents CSV here](logs/deviceprocessevents.csv)

![screenshot](screenshots/20-deviceprocessevents.png)


### üåê Network Events (`DeviceNetworkEvents`)

```kql
DeviceNetworkEvents
| where DeviceName == "j-win10-cve"
| where InitiatingProcessAccountName == "jnguyen.admin"
| where RemoteIP == "185.199.111.133"
| project Timestamp, DeviceName, AccountName = InitiatingProcessAccountName, ActionType, RemoteIP, RemotePort, RemoteUrl, InitiatingProcessCommandLine, InitiatingProcessSHA256
| order by Timestamp asc
```

* **Status:** Logs and screenshots captured for suspicious outbound IP connection.
* [See DeviceNetworkEvents CSV here](logs/devicenetworkevents.csv)

![screenshot](screenshots/21-devicenetworkevents.png)

---

## üß† 7. Indicators of Compromise (IOCs)

### üîó Hashes

| Type    | Value                                                              |
| ------- | ------------------------------------------------------------------ |
| SHA-256 | `739D9923E2DDF467CE9F997C82D36BFB72ACCC90ACC40573EAA5E1ABB2097CD8` |

### üóÇ File Artifacts

* `C:\ProgramData\pwncrypt.ps1`
* `C:\Users\jnguyen.admin\Desktop\__________decryption-instructions` *(ransom note)*

### üåê Network IOCs

| Type | Value             |
| ---- | ----------------- |
| IP   | `185.199.111.133` |

---

## üõ°Ô∏è 8. Mitigation & Detection Recommendations

* Block outbound access to `185.199.111.133` in firewall/DNS
* Review PowerShell execution policies and logging settings
* Enable ScriptBlock logging for deeper audit visibility
* Consider adding SHA256 to EDR or AV blocklists
* Restore any modified or encrypted files from backup

---

## üîó 9. Kill Chain ‚Üî MITRE ATT&CK Mapping

| Kill Chain Phase         | ATT&CK Technique                         | ID         | Description                                                       | Observed in PwnCrypt? |
|--------------------------|------------------------------------------|------------|-------------------------------------------------------------------|------------------------|
| 1. Reconnaissance        | N/A                                      | N/A        | No scanning or info gathering included in the simulation          | ‚ùå                    |
| 2. Resource Development  | N/A                                      | N/A        | No tool or infrastructure prep simulated                          | ‚ùå                    |
| 3. Initial Access        | User Execution: Malicious Script         | T1059.001  | PowerShell script executed manually by user                      | ‚úÖ                    |
| 4. Execution             | PowerShell                               | T1059.001  | Core execution method used by PwnCrypt                            | ‚úÖ                    |
|                          | WMI (WMI Execution)                      | T1047      | May be used by script internally for operations (assumed)         | ‚ö†Ô∏è Possibly           |
| 5. Persistence           | N/A                                      | N/A        | No persistence mechanism in script                                | ‚ùå                    |
| 6. Privilege Escalation | N/A                                      | N/A        | Script runs under same user context                               | ‚ùå                    |
| 7. Defense Evasion       | Obfuscated Files or Information          | T1027      | PowerShell code may include obfuscation (to test later)           | ‚úÖ                    |
|                          | Disabling Security Tools                 | T1562      | No evidence of disabling AV or logs                               | ‚ùå                    |
| 8. Credential Access     | N/A                                      | N/A        | No credential harvesting activity                                 | ‚ùå                    |
| 9. Discovery             | N/A                                      | N/A        | No host or network discovery performed                            | ‚ùå                    |
| 10. Lateral Movement     | N/A                                      | N/A        | Single-host execution only                                        | ‚ùå                    |
| 11. Collection           | N/A                                      | N/A        | No data gathering beyond file encryption                          | ‚ùå                    |
| 12. Command & Control    | Application Layer Protocol: HTTPS        | T1071.001  | Outbound IP: `185.199.111.133` observed                           | ‚úÖ                    |
| 13. Exfiltration         | N/A                                      | N/A        | No evidence of data exfiltration                                  | ‚ùå                    |
| 14. Impact               | Data Encrypted for Impact                | T1486      | Dummy files were encrypted; ransom note created                   | ‚úÖ                    |

### ‚úÖ Summary of Confirmed ATT\&CK Techniques

| Technique ID | Name                             | Phase             |
| ------------ | -------------------------------- | ----------------- |
| T1059.001    | PowerShell                       | Execution         |
| T1047        | WMI Execution *(possibly used)*  | Execution         |
| T1027        | Obfuscated Files or Information  | Defense Evasion   |
| T1071.001    | C2 via Application Layer (HTTPS) | Command & Control |
| T1486        | Data Encrypted for Impact        | Impact            |

---

## üßæ 10. Postmortem

### ‚úÖ What Went Well

* Successfully executed a ransomware simulation in a controlled, isolated environment.
* Leveraged Microsoft Defender for Endpoint (MDE) for telemetry, log collection, and timeline correlation.
* Captured key file, process, and network artifacts with accurate timestamps.
* Practiced and validated KQL queries for threat hunting and incident triage.
* Documented findings clearly with screenshots and structured markdown.

### üß† Lessons Learned

* Static analysis of PowerShell scripts requires different tools than binary files (e.g., PEStudio offered limited insight here).
* Enabling **ScriptBlock logging** is essential for full PowerShell visibility‚Äîthis was disabled in the test VM.
* Understanding how Windows logs (e.g., 4688) correlate to script execution is critical; some benign startup processes initially caused confusion.
* Importance of exporting and backing up logs and screenshots in real time, as forensic artifacts may be ephemeral.

### ‚ö†Ô∏è What Could Be Improved

* **Strings analysis failed:** Was unable to export PowerShell script strings due to an error. Next time, try using:

  * `Select-String` in PowerShell
  * `Notepad++` or `VS Code` to review inline code manually
* **No dynamic code instrumentation or debugging was performed.** Tools like PowerShell ISE debugger or Sysmon were not used.
* **Reverse engineering/code walkthrough was omitted.** Future analysis should include:

  * Function-level code review
  * Identification of obfuscation or anti-analysis mechanisms
  * Behavioral mapping (e.g., encryption loops, command structures)

### üîÑ Next Steps

* Re-run analysis with ScriptBlock logging enabled and attempt full PowerShell code dissection.
* Integrate additional telemetry from Sysmon or Elastic Agent for deeper insight.
* Add automated IOC extraction to streamline reporting.
* Begin creating a YARA rule or Sigma detection for `pwncrypt.ps1` behavior as practice.

---

*End of Report*


